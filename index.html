<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>FlowerShop –ö–∞—Ç–∞–ª–æ–≥</title>

  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family: -apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Arial,sans-serif; }
    body { background: #fff9fb; padding:16px; color:#333; max-width:520px; margin:0 auto; }
    .header { text-align:center; padding:16px 0; border-bottom:2px solid #f8d7da; margin-bottom:16px; }
    .header h1 { color:#e83e8c; font-size:22px; margin-bottom:6px; }
    .header p { color:#6c757d; font-size:14px; }
    .bouquet { background:#fff; border-radius:12px; padding:16px; box-shadow:0 2px 8px rgba(0,0,0,.08); margin-bottom:110px; }
    .bouquet img { width:100%; height:220px; object-fit:cover; border-radius:10px; margin-bottom:12px; }
    .price { font-size:22px; font-weight:800; color:#e74c3c; margin:12px 0; }
    .section-title { font-size:15px; font-weight:700; margin:14px 0 10px; }
    .color-palette { display:flex; gap:8px; flex-wrap:wrap; }
    .color-btn { width:34px; height:34px; border-radius:50%; border:2px solid #ddd; cursor:pointer; }
    .color-btn.active { border-color:#333; box-shadow:0 0 0 2px #fff, 0 0 0 4px #333; }
    .add-ons { display:flex; gap:8px; flex-wrap:wrap; margin-bottom:10px; }
    .add-on { flex:1; min-width:110px; text-align:center; padding:10px 12px; border-radius:10px; border:1px solid #eee; background:#f8f9fa; cursor:pointer; font-size:13px; }
    .add-on.active { background:linear-gradient(135deg,#e83e8c,#9b59b6); color:#fff; border-color:#e83e8c; }
    .delivery-option { display:flex; align-items:center; padding:12px; border-radius:10px; background:#f8f9fa; border:2px solid transparent; margin-bottom:8px; cursor:pointer; }
    .delivery-option.active { border-color:#e83e8c; background:#fff0f5; }
    .delivery-option input { display:none; }
    .delivery-option label { margin-left:8px; flex:1; font-size:14px; }
    .price-tag { font-weight:800; color:#e74c3c; }
    .promo-code input { width:100%; padding:12px; border-radius:10px; border:1px solid #ced4da; font-size:14px; }
    .btn { width:100%; padding:14px; border:none; border-radius:12px; color:#fff; font-weight:800; font-size:16px; cursor:pointer;
      background:linear-gradient(135deg,#e83e8c,#9b59b6); box-shadow:0 4px 12px rgba(232,62,140,.25); }
    .btn:disabled { opacity:.6; cursor:not-allowed; box-shadow:none; }
    .basket { position:fixed; left:0; right:0; bottom:0; background:#fff; padding:14px 16px; border-top:2px solid #f8d7da; box-shadow:0 -2px 12px rgba(0,0,0,.08); }
    .basket-total { display:flex; justify-content:space-between; align-items:center; margin-bottom:8px; }
    .basket-total strong { font-size:20px; color:#e74c3c; }
    .order-summary { font-size:13px; color:#555; }
    .order-item { display:flex; justify-content:space-between; margin:6px 0; }
    .toast { position:fixed; top:18px; left:50%; transform:translateX(-50%); background:#28a745; color:#fff; padding:10px 16px; border-radius:10px; z-index:9999; }
    .toast.error { background:#dc3545; }
  </style>
</head>

<body>
  <div class="header">
    <h1>üíê –ö–∞—Ç–∞–ª–æ–≥ –±—É–∫–µ—Ç–æ–≤</h1>
    <p>–í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç, –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è –∏ –¥–æ—Å—Ç–∞–≤–∫—É</p>
  </div>

  <div class="bouquet">
    <img src="https://i.imgur.com/7Z1kZ4l.jpg" alt="–ë—É–∫–µ—Ç" id="bouquet-img">
    <h3>–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –±—É–∫–µ—Ç</h3>
    <p>–†–æ–∑—ã, –ª–∏–ª–∏–∏, —ç—É—Å—Ç–æ–º–∞ –≤ –Ω–µ–∂–Ω—ã—Ö —Ç–æ–Ω–∞—Ö.</p>
    <div class="price" id="base-price">‚ÇΩ 3 500</div>

    <div class="section-title">üé® –í—ã–±–µ—Ä–∏—Ç–µ —Ü–≤–µ—Ç:</div>
    <div class="color-palette">
      <div class="color-btn active" style="background:#e83e8c" data-color="#e83e8c"></div>
      <div class="color-btn" style="background:#3498db" data-color="#3498db"></div>
      <div class="color-btn" style="background:#2ecc71" data-color="#2ecc71"></div>
      <div class="color-btn" style="background:#f39c12" data-color="#f39c12"></div>
      <div class="color-btn" style="background:#9b59b6" data-color="#9b59b6"></div>
    </div>

    <div class="section-title">üéÅ –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è:</div>
    <div class="add-ons">
      <div class="add-on" data-price="1000">üß∏ –ú–∏—à–∫–∞ (+1000‚ÇΩ)</div>
      <div class="add-on" data-price="300">üç¨ –ö–æ–Ω—Ñ–µ—Ç—ã (+300‚ÇΩ)</div>
      <div class="add-on" data-price="500">üç´ –®–æ–∫–æ–ª–∞–¥ (+500‚ÇΩ)</div>
    </div>

    <div class="section-title">üöö –î–æ—Å—Ç–∞–≤–∫–∞:</div>
    <div class="delivery">
      <div class="delivery-option active" data-type="center" data-price="1500">
        <input type="radio" name="delivery" value="center" checked>
        <label>–¶–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤—ã <span class="price-tag">(1500 ‚ÇΩ)</span></label>
      </div>
      <div class="delivery-option" data-type="mkad" data-price="2000">
        <input type="radio" name="delivery" value="mkad">
        <label>–î–æ –ú–ö–ê–î <span class="price-tag">(2000 ‚ÇΩ)</span></label>
      </div>
      <div class="delivery-option" data-type="self" data-price="0">
        <input type="radio" name="delivery" value="self">
        <label>–°–∞–º–æ–≤—ã–≤–æ–∑ <span class="price-tag">(–±–µ—Å–ø–ª–∞—Ç–Ω–æ)</span></label>
      </div>
    </div>

    <div class="section-title">üè∑ –ü—Ä–æ–º–æ–∫–æ–¥:</div>
    <div class="promo-code">
      <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥" id="promo-code">
    </div>

    <button class="btn" id="btn-add">–î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É</button>
  </div>

  <div class="basket">
    <div class="basket-total">
      <span>–ò—Ç–æ–≥–æ:</span>
      <strong id="total-price">‚ÇΩ 5 000</strong>
    </div>
    <div class="order-summary" id="order-summary"></div>
    <button class="btn" id="btn-checkout">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.ready();

    let selectedColor = '#e83e8c';
    let selectedAddOns = [];
    let selectedDelivery = 'center';
    let deliveryPrice = 1500;
    let promoCode = '';
    let basePrice = 3500;

    function showToast(text, type='success') {
      const t = document.createElement('div');
      t.className = 'toast' + (type === 'error' ? ' error' : '');
      t.textContent = text;
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 2500);
    }

    function getColorName(color) {
      const colors = {
        '#e83e8c': '–†–æ–∑–æ–≤—ã–π',
        '#3498db': '–ì–æ–ª—É–±–æ–π',
        '#2ecc71': '–ó–µ–ª—ë–Ω—ã–π',
        '#f39c12': '–û—Ä–∞–Ω–∂–µ–≤—ã–π',
        '#9b59b6': '–§–∏–æ–ª–µ—Ç–æ–≤—ã–π'
      };
      return colors[color] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π';
    }

    function getAddOnName(price) {
      const addOns = { 1000:'üß∏ –ú–∏—à–∫–∞', 300:'üç¨ –ö–æ–Ω—Ñ–µ—Ç—ã', 500:'üç´ –®–æ–∫–æ–ª–∞–¥' };
      return addOns[price] || '–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ';
    }

    function getDeliveryName(type) {
      const delivery = {
        'self':'–°–∞–º–æ–≤—ã–≤–æ–∑ (–±–µ—Å–ø–ª–∞—Ç–Ω–æ)',
        'center':'–¶–µ–Ω—Ç—Ä –ú–æ—Å–∫–≤—ã (1500 ‚ÇΩ)',
        'mkad':'–î–æ –ú–ö–ê–î (2000 ‚ÇΩ)'
      };
      return delivery[type] || '–î–æ—Å—Ç–∞–≤–∫–∞';
    }

    function updateTotal() {
      let total = basePrice;
      selectedAddOns.forEach(p => total += p);
      total += deliveryPrice;

      let discount = 0;
      if (promoCode.toLowerCase() === 'flower2024') discount = total * 0.10;
      total = Math.max(0, total - discount);

      document.getElementById('total-price').textContent = `‚ÇΩ ${total.toLocaleString('ru-RU')}`;

      let html = `
        <div class="order-item"><span>–ë—É–∫–µ—Ç:</span><span>–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π</span></div>
        <div class="order-item"><span>–¶–≤–µ—Ç:</span><span>${getColorName(selectedColor)}</span></div>
      `;
      selectedAddOns.forEach(price => {
        html += `<div class="order-item"><span>–î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:</span><span>${getAddOnName(price)} (+${price}‚ÇΩ)</span></div>`;
      });
      html += `<div class="order-item"><span>–î–æ—Å—Ç–∞–≤–∫–∞:</span><span>${getDeliveryName(selectedDelivery)}</span></div>`;
      if (discount > 0) html += `<div class="order-item"><span>–°–∫–∏–¥–∫–∞:</span><span>-${discount.toLocaleString('ru-RU')} ‚ÇΩ</span></div>`;
      html += `<div class="order-item"><span><b>–ò—Ç–æ–≥–æ:</b></span><span><b>‚ÇΩ ${total.toLocaleString('ru-RU')}</b></span></div>`;
      document.getElementById('order-summary').innerHTML = html;
    }

    // –¶–≤–µ—Ç
    document.querySelectorAll('.color-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedColor = btn.dataset.color;
        updateTotal();
      });
    });

    // –î–æ–ø—ã
    document.querySelectorAll('.add-on').forEach(btn => {
      btn.addEventListener('click', () => {
        btn.classList.toggle('active');
        const price = parseInt(btn.dataset.price, 10);
        const idx = selectedAddOns.indexOf(price);
        if (idx === -1) selectedAddOns.push(price);
        else selectedAddOns.splice(idx, 1);
        updateTotal();
      });
    });

    // –î–æ—Å—Ç–∞–≤–∫–∞
    document.querySelectorAll('.delivery-option').forEach(opt => {
      opt.addEventListener('click', () => {
        document.querySelectorAll('.delivery-option').forEach(o => o.classList.remove('active'));
        opt.classList.add('active');
        selectedDelivery = opt.dataset.type;
        deliveryPrice = parseInt(opt.dataset.price, 10);
        updateTotal();
      });
    });

    // –ü—Ä–æ–º–æ–∫–æ–¥
    document.getElementById('promo-code').addEventListener('input', (e) => {
      promoCode = e.target.value.trim();
      updateTotal();
    });

    document.getElementById('btn-add').addEventListener('click', () => {
      showToast('‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω—É');
      updateTotal();
    });

    // ‚úÖ –û–¢–ü–†–ê–í–ö–ê –í –ë–û–¢–ê
    document.getElementById('btn-checkout').addEventListener('click', () => {
      const btn = document.getElementById('btn-checkout');
      btn.disabled = true;

      const addOnsArray = selectedAddOns.map(price => `${getAddOnName(price)} (+${price}‚ÇΩ)`);

      const totalNumber = Number(String(document.getElementById('total-price').textContent).replace(/\D/g, ""));

      const orderData = {
        bouquet: "romantic",
        color: selectedColor,
        add_ons: addOnsArray,
        total_price: totalNumber,
        promo_code: promoCode,
        delivery_type: selectedDelivery,
        delivery_price: deliveryPrice
      };

      try {
        tg.sendData(JSON.stringify(orderData));
        showToast("‚úÖ –ó–∞–∫–∞–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –±–æ—Ç");

        // ‚úÖ –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–≥–Ω–æ–≤–µ–Ω–Ω–æ (–∏–Ω–∞—á–µ –∏–Ω–æ–≥–¥–∞ –∞–ø–¥–µ–π—Ç –Ω–µ –¥–æ–ª–µ—Ç–∞–µ—Ç)
        setTimeout(() => tg.close(), 1200);

      } catch (e) {
        console.error(e);
        showToast("‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏", "error");
        btn.disabled = false;
      }
    });

    updateTotal();
  </script>
</body>
</html>
