<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Telegram Mini App</title>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>

  <style>
    body { font-family: Arial, sans-serif; padding: 16px; }
    button { padding: 12px 16px; font-size: 16px; }
    textarea { width: 100%; height: 120px; margin-top: 12px; }
    .status { margin-top: 12px; white-space: pre-wrap; }
  </style>
</head>
<body>

<h2>Mini-App ‚Üí Bot ‚Üí Group</h2>

<button id="send">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ –≥—Ä—É–ø–ø—É</button>

<textarea id="text" placeholder="–¢–µ–∫—Å—Ç (–º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º)"></textarea>

<div class="status" id="status"></div>

<script>
  const API_URL = "https://tg-miniapp-backend-production.up.railway.app";
  const API_KEY = "my_secret_key_123"; // —Ç–æ—Ç –∂–µ, —á—Ç–æ –≤ Railway Variables

  const statusEl = document.getElementById("status");
  const textEl = document.getElementById("text");

  const tg = window.Telegram?.WebApp;
  if (tg) {
    tg.ready();
    tg.expand();
  }

  function buildText() {
    if (textEl.value.trim()) return textEl.value.trim();

    const user = tg?.initDataUnsafe?.user;
    if (user) {
      return `üë§ ${user.first_name} ${user.last_name || ""}\nüÜî ${user.id}`;
    }

    return "–¢–µ—Å—Ç –∏–∑ mini-app (–±—Ä–∞—É–∑–µ—Ä)";
  }

  document.getElementById("send").onclick = async () => {
    statusEl.textContent = "–û—Ç–ø—Ä–∞–≤–ª—è—é...";

    try {
      const r = await fetch(`${API_URL}/api/send`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-API-Key": API_KEY
        },
        body: JSON.stringify({ text: buildText() })
      });

      const data = await r.json().catch(() => ({}));

      if (!r.ok) {
        statusEl.textContent = "–û—à–∏–±–∫–∞:\n" + JSON.stringify(data, null, 2);
        return;
      }

      statusEl.textContent = "–û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ";
      if (tg) tg.showAlert("–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ");

    } catch (e) {
      statusEl.textContent = "–°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞:\n" + e;
    }
  };
</script>

</body>
</html>
